<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>FC26 Saitama Open Arena ‚Ä¢ Table</title>
    <style>
        body {
            font-family: system-ui;
            margin: 0;
            background: #0b0f16;
            color: #e6ebf2
        }

        .wrap {
            max-width: 1100px;
            margin: 0 auto;
            padding: 16px
        }

        a {
            color: #4da3ff;
            text-decoration: none
        }

        .pill {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #121826;
            border-radius: 14px;
            padding: 12px
        }

        .card {
            background: #121826;
            border-radius: 14px;
            padding: 14px;
            margin: 12px 0
        }

        table {
            width: 100%;
            border-collapse: collapse
        }

        th,
        td {
            border-bottom: 1px solid #2a3248;
            padding: 10px;
            text-align: left
        }

        th {
            color: #8a93a6;
            font-size: 13px
        }

        .muted {
            color: #8a93a6;
            font-size: 13px
        }

        .badge {
            display: inline-block;
            border: 1px solid #2a3248;
            color: #8a93a6;
            padding: 2px 8px;
            border-radius: 999px;
            font-size: 12px
        }
    </style>
</head>

<body>
    <div class="wrap">
        <div class="pill">
            <div><b>FC26 Saitama Open Arena</b> <span class="muted">Table</span></div>
            <div><a href="./index.html">Home</a> ¬∑ <a href="./bracket.html">Bracket</a></div>
        </div>

        <div class="card">
            <b>Standings (Group)</b>
            <div class="muted">Win 3 / Draw 1 / Loss 0 ‚Äî GF/GA/GD</div>
            <div id="standings"></div>
        </div>

        <div class="card">
            <b>Group Matches</b>
            <div id="matches"></div>
        </div>

        <div class="card">
            <b>Playoffs & Final</b>
            <div id="po"></div>
        </div>
    </div>

    <script type="module">
        import { load } from "./js/app_state.js";
        import { avatarEmoji, playerName } from "./js/ui_shared.js";
        import { recalcStandings, ensurePlayoffsGenerated } from "./js/tournament_engine.js";

        const state = load();
        if (!state?.tournament) { location.href = "./index.html"; }
        const t = state.tournament;

        recalcStandings(t);
        ensurePlayoffsGenerated(t);

        function standingsHTML() {
            const s = t.group.standings || [];
            const rows = s.map((p, i) => `
    <tr>
      <td><span class="badge">#${i + 1}</span></td>
      <td>${avatarEmoji(p.avatarKey)} <b>${p.name}</b></td>
      <td>${p.stats.played}</td>
      <td>${p.stats.win}</td>
      <td>${p.stats.draw}</td>
      <td>${p.stats.loss}</td>
      <td>${p.stats.gf}</td>
      <td>${p.stats.ga}</td>
      <td>${p.stats.gd}</td>
      <td><b>${p.stats.pts}</b></td>
    </tr>
  `).join("");
            return `
    <table>
      <thead><tr>
        <th>#</th><th>Player</th><th>P</th><th>W</th><th>D</th><th>L</th><th>GF</th><th>GA</th><th>GD</th><th>PTS</th>
      </tr></thead>
      <tbody>${rows}</tbody>
    </table>
  `;
        }

        function matchRow(m) {
            const A = t.players[m.aId], B = t.players[m.bId];
            const sc = (m.score.a === null || m.score.b === null) ? "‚Äî" : `${m.score.a} - ${m.score.b}`;
            const ta = m.teams.a ? `<span class="badge">${m.teams.a}</span>` : `<span class="badge">TBD</span>`;
            const tb = m.teams.b ? `<span class="badge">${m.teams.b}</span>` : `<span class="badge">TBD</span>`;
            return `
    <tr>
      <td>R${m.round}</td>
      <td>${avatarEmoji(A.avatarKey)} ${A.name} ${ta}</td>
      <td>${avatarEmoji(B.avatarKey)} ${B.name} ${tb}</td>
      <td><b>${sc}</b></td>
    </tr>
  `;
        }

        function matchesHTML() {
            const rows = t.group.matches.map(matchRow).join("");
            return `
    <table>
      <thead><tr><th>Round</th><th>Home</th><th>Away</th><th>Score</th></tr></thead>
      <tbody>${rows}</tbody>
    </table>
  `;
        }

        function poHTML() {
            const lines = [];

            if (t.playoff1) {
                const A = t.players[t.playoff1.aId], B = t.players[t.playoff1.bId];
                const sc = (t.playoff1.score.a === null || t.playoff1.score.b === null) ? "‚Äî" : `${t.playoff1.score.a} - ${t.playoff1.score.b}`;
                lines.push(`<div><b>Playoff 1</b>: ${A.name} vs ${B.name} ‚Äî <b>${sc}</b></div>`);
            }
            if (t.playoff2 && t.playoff2.aId !== null) {
                const A = t.players[t.playoff2.aId], B = t.players[t.playoff2.bId];
                const sc = (t.playoff2.score.a === null || t.playoff2.score.b === null) ? "‚Äî" : `${t.playoff2.score.a} - ${t.playoff2.score.b}`;
                lines.push(`<div><b>Playoff 2</b>: ${A.name} vs ${B.name} ‚Äî <b>${sc}</b></div>`);
            } else {
                lines.push(`<div class="muted">Playoff 2: ch·ªù Playoff 1 xong.</div>`);
            }

            if (t.final?.p2Id !== null) {
                const A = t.players[t.final.p1Id], B = t.players[t.final.p2Id];
                lines.push(`<div style="margin-top:8px"><b>Final BO3</b>: ${A.name} vs ${B.name}</div>`);
                lines.push(`<div class="muted">Games played: ${t.final.matches.length} | Winner: ${t.final.winnerId !== null ? playerName(t, t.final.winnerId) : "TBD"}</div>`);
            } else {
                lines.push(`<div class="muted">Final: ch·ªù Playoff 2 xong.</div>`);
            }

            if (t.championId !== null) {
                lines.push(`<div style="margin-top:10px"><b>üèÜ Champion:</b> ${playerName(t, t.championId)}</div>`);
            }

            return lines.join("");
        }

        document.getElementById("standings").innerHTML = standingsHTML();
        document.getElementById("matches").innerHTML = matchesHTML();
        document.getElementById("po").innerHTML = poHTML();
    </script>
</body>

</html>